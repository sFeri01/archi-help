name: Generate PDF from README

on:
  push:
    branches:
      - main
      - edit

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set PDF filename
        id: pdf-name
        run: |
          if [ "${{ github.ref }}" == "refs/heads/edit" ]; then
            echo "filename=Archi_edit.pdf" >> $GITHUB_OUTPUT
          else
            echo "filename=Archi.pdf" >> $GITHUB_OUTPUT
          fi

      - name: Convert README to PDF
        uses: docker://pandoc/extra:latest
        with:
          args: >-
            --pdf-engine=xelatex
            -V geometry:margin=2cm
            -V lang=hu
            -V title="Archi seg√©dlet"
            -V table-use-row-colors
            --template eisvogel
            -V secnumdepth=3
            --syntax-highlighting=idiomatic
            --toc
            -V toc-own-page
            --number-sections
            --shift-heading-level-by=-1
            -o ${{ steps.pdf-name.outputs.filename }}
            -f markdown+pipe_tables+yaml_metadata_block
            README.md

      - name: Release PDF
        uses: softprops/action-gh-release@v2
        with:
          files: |
            ${{ steps.pdf-name.outputs.filename }}
          tag_name: latest-pdf
          name: Release ${{ github.run_number }}
          body: "Auto-generated PDF from README.md from commit ${{ github.sha }}"
